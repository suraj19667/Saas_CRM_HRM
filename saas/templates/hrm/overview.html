{% extends 'hrm/hrm_base.html' %}

{% block title %}Overview{% endblock %}
{% block page_title %}Overview{% endblock %}

{% block content %}
<style>
    .festive-banner {
        background: linear-gradient(135deg, #e0e7ff 0%, #ddd6fe 100%);
        border: 2px solid #6366f1;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 24px;
        position: relative;
        overflow: hidden;
    }

    .festive-banner::before {
        content: 'ðŸŽ‰';
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 48px;
        opacity: 0.3;
    }

    .plan-status-card {
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        color: white;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 24px;
    }

    .quick-action-card {
        text-align: center;
        padding: 20px;
        border-radius: 10px;
        background: white;
        border: 2px dashed var(--border-color);
        transition: all 0.2s;
        cursor: pointer;
    }

    .quick-action-card:hover {
        border-color: var(--primary-color);
        background-color: #f8faff;
    }

    .usage-item {
        background: white;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 16px;
        border: 1px solid var(--border-color);
    }

    .invoice-item {
        background: white;
        padding: 16px;
        border-radius: 8px;
        margin-bottom: 12px;
        border: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
</style>

<!-- Festive Offer Banner -->
<div class="festive-banner">
    <button type="button" class="btn-close float-end" aria-label="Close" style="font-size: 12px;"></button>
    <div>
        <h5 class="mb-2" style="color: #6366f1; font-weight: 700;">
            <i class="bi bi-gift"></i> Festive Offer! Get 20% off on annual plans
        </h5>
        <p class="mb-2" style="color: #4f46e5; font-size: 14px;">
            Upgrade to annual billing before Dec 31st and save big on your subscription.
        </p>
        <a href="{% url 'hrm_my_plan' %}" class="btn btn-primary btn-sm">
            View Offer <i class="bi bi-arrow-right"></i>
        </a>
    </div>
</div>

<!-- Plan Status Card -->
<div class="plan-status-card">
    <div class="row align-items-center">
        <div class="col-md-3">
            <div class="mb-2">
                <small style="opacity: 0.8;">Plan Name</small>
            </div>
            <h4 class="mb-0" style="font-weight: 700;">
                {% if plan %}{{ plan.name }}{% else %}No Plan{% endif %}
            </h4>
        </div>
        <div class="col-md-3">
            <div class="mb-2">
                <small style="opacity: 0.8;">Billing Type</small>
            </div>
            <h5 class="mb-0" style="font-weight: 600;">
                {% if subscription %}{{ subscription.billing_cycle|title }}{% else %}â€”{% endif %}
            </h5>
        </div>
        <div class="col-md-3">
            <div class="mb-2">
                <small style="opacity: 0.8;">Purchase Date</small>
            </div>
            <h6 class="mb-0" style="font-weight: 600;">
                {% if purchase_date %}{{ purchase_date|date:"d M Y" }}{% else %}â€”{% endif %}
            </h6>
        </div>
        <div class="col-md-3">
            <div class="mb-2">
                <small style="opacity: 0.8;">Next Renewal</small>
            </div>
            <h6 class="mb-0" style="font-weight: 600;">
                {% if next_renewal %}{{ next_renewal|date:"d M Y" }}{% else %}â€”{% endif %}
            </h6>
        </div>
    </div>
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="d-flex justify-content-between align-items-center">
                {% if subscription %}
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="autoRenew" {% if auto_renew %}checked{% endif %}>
                    <label class="form-check-label" for="autoRenew">
                        Auto-renew enabled
                    </label>
                </div>
                <div>
                    <span class="badge bg-success" style="font-size: 14px; padding: 8px 16px;">
                        <i class="bi bi-check-circle"></i> Active
                    </span>
                </div>
                {% else %}
                <div>
                    <a href="{% url 'hrm_plans' %}" class="btn btn-light btn-lg">
                        <i class="bi bi-plus-circle"></i> Choose Plan
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Usage Snapshot -->
<div class="row mb-4">
    <div class="col-12">
        <h5 class="mb-3" style="font-weight: 600;">Usage Snapshot</h5>
    </div>

    <div class="col-md-3 mb-3">
        <div class="stat-card">
            <div class="d-flex justify-content-between align-items-start mb-2">
                <div>
                    <div class="stat-label"><i class="bi bi-people"></i> Employees</div>
                    <div class="stat-value">{{ usage_data.employees.current }}/{{ usage_data.employees.limit }}</div>
                </div>
                <div>
                    <h4 style="color: #6366f1; margin: 0;">{{ usage_data.employees.percentage }}%</h4>
                </div>
            </div>
            <div class="progress" style="height: 8px;">
                <div class="progress-bar"
                    style="width: {{ usage_data.employees.percentage }}%; background-color: #6366f1;">
                </div>
            </div>
            {% if usage_data.employees.percentage >= 85 %}
            <small class="text-warning mt-2 d-block">
                <i class="bi bi-exclamation-triangle"></i> Approaching limit. Consider upgrading.
            </small>
            {% else %}
            <small class="text-muted mt-2 d-block">{{
                usage_data.employees.limit|add:"-"|add:usage_data.employees.current }} employees available</small>
            {% endif %}
        </div>
    </div>

    <div class="col-md-3 mb-3">
        <div class="stat-card">
            <div class="d-flex justify-content-between align-items-start mb-2">
                <div>
                    <div class="stat-label"><i class="bi bi-shield-check"></i> Admins</div>
                    <div class="stat-value">{{ usage_data.admins.current }}/{{ usage_data.admins.limit }}</div>
                </div>
                <div>
                    <h4 style="color: #10b981; margin: 0;">{{ usage_data.admins.percentage }}%</h4>
                </div>
            </div>
            <div class="progress" style="height: 8px;">
                <div class="progress-bar"
                    style="width: {{ usage_data.admins.percentage }}%; background-color: #10b981;"></div>
            </div>
            {% if usage_data.admins.percentage >= 85 %}
            <small class="text-warning mt-2 d-block">
                <i class="bi bi-exclamation-triangle"></i> Approaching limit.
            </small>
            {% else %}
            <small class="text-muted mt-2 d-block">{{ usage_data.admins.limit|add:"-"|add:usage_data.admins.current }}
                admin slots available</small>
            {% endif %}
        </div>
    </div>

    <div class="col-md-3 mb-3">
        <div class="stat-card">
            <div class="d-flex justify-content-between align-items-start mb-2">
                <div>
                    <div class="stat-label"><i class="bi bi-hdd"></i> Storage</div>
                    <div class="stat-value">{{ usage_data.storage.current }}/{{ usage_data.storage.limit }} GB</div>
                </div>
                <div>
                    <h4 style="color: #f59e0b; margin: 0;">{{ usage_data.storage.percentage }}%</h4>
                </div>
            </div>
            <div class="progress" style="height: 8px;">
                <div class="progress-bar"
                    style="width: {{ usage_data.storage.percentage }}%; background-color: #f59e0b;"></div>
            </div>
            {% if usage_data.storage.percentage >= 85 %}
            <small class="text-warning mt-2 d-block">
                <i class="bi bi-exclamation-triangle"></i> Storage almost full.
            </small>
            {% else %}
            <small class="text-muted mt-2 d-block">Storage available</small>
            {% endif %}
        </div>
    </div>

    <div class="col-md-3 mb-3">
        <div class="stat-card">
            <div class="d-flex justify-content-between align-items-start mb-2">
                <div>
                    <div class="stat-label"><i class="bi bi-grid"></i> Modules</div>
                    <div class="stat-value">{{ usage_data.modules.active }}/{{ usage_data.modules.available }}</div>
                </div>
                <div>
                    <h4 style="color: #3b82f6; margin: 0;">{{ usage_data.modules.percentage }}%</h4>
                </div>
            </div>
            <div class="progress" style="height: 8px;">
                <div class="progress-bar"
                    style="width: {{ usage_data.modules.percentage }}%; background-color: #3b82f6;">
                </div>
            </div>
            <small class="text-muted mt-2 d-block">{{ usage_data.modules.available|add:"-"|add:usage_data.modules.active
                }} more modules available</small>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row mb-4">
    <div class="col-12">
        <h5 class="mb-3" style="font-weight: 600;">Quick Actions</h5>
    </div>

    <div class="col-md-3 mb-3">
        <a href="{% url 'hrm_my_plan' %}" class="text-decoration-none">
            <div class="quick-action-card">
                <i class="bi bi-arrow-up-circle" style="font-size: 36px; color: var(--primary-color);"></i>
                <h6 class="mt-3 mb-1">Upgrade Plan</h6>
                <small class="text-muted">Get more features</small>
            </div>
        </a>
    </div>

    <div class="col-md-3 mb-3">
        <a href="{% url 'hrm_addons' %}" class="text-decoration-none">
            <div class="quick-action-card">
                <i class="bi bi-puzzle" style="font-size: 36px; color: var(--success-color);"></i>
                <h6 class="mt-3 mb-1">Browse Add-ons</h6>
                <small class="text-muted">Extend functionality</small>
            </div>
        </a>
    </div>

    <div class="col-md-3 mb-3">
        <a href="{% url 'hrm_billing' %}" class="text-decoration-none">
            <div class="quick-action-card">
                <i class="bi bi-receipt" style="font-size: 36px; color: var(--warning-color);"></i>
                <h6 class="mt-3 mb-1">View Invoices</h6>
                <small class="text-muted">Download receipts</small>
            </div>
        </a>
    </div>

    <div class="col-md-3 mb-3">
        <a href="{% url 'hrm_support' %}" class="text-decoration-none">
            <div class="quick-action-card">
                <i class="bi bi-headset" style="font-size: 36px; color: var(--info-color);"></i>
                <h6 class="mt-3 mb-1">Get Support</h6>
                <small class="text-muted">We're here to help</small>
            </div>
        </a>
    </div>
</div>

<!-- Recent Invoices -->
<div class="row">
    <div class="col-12">
        <h5 class="mb-3" style="font-weight: 600;">Recent Invoices</h5>
    </div>

    <div class="col-12">
        {% if recent_invoices %}
        {% for invoice in recent_invoices %}
        <div class="invoice-item">
            <div>
                <strong>Invoice #{{ invoice.invoice_number }}</strong>
                <br>
                <small class="text-muted">{{ invoice.created_at|date:"M d, Y" }}</small>
            </div>
            <div>
                <strong style="font-size: 18px;">â‚¹{{ invoice.amount }}</strong>
                <span class="badge bg-success ms-2">Paid</span>
            </div>
        </div>
        {% endfor %}
        <div class="text-center mt-3">
            <a href="{% url 'hrm_billing' %}" class="btn btn-outline-primary">View All Invoices</a>
        </div>
        {% else %}
        <div class="text-center py-5">
            <i class="bi bi-receipt" style="font-size: 48px; color: var(--gray-text);"></i>
            <p class="mt-3 text-muted">No invoices yet</p>
        </div>
        {% endif %}
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Auto-renew toggle
    document.getElementById('autoRenew')?.addEventListener('change', function () {
        // TODO: Send AJAX request to update auto-renew setting
        console.log('Auto-renew toggled:', this.checked);
    });
</script>
{% endblock %} 