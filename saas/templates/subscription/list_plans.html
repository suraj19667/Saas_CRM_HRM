{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Available Plans</h2>
    </div>

    {% if current_subscription %}
    <div class="alert alert-info">
        <strong>Current Subscription:</strong> {{ current_subscription.plan.name }}
        ({{ current_subscription.billing_cycle }} - {{ current_subscription.status }})
        {% if current_subscription.status == 'active' %}
        <a href="{% url 'subscription:cancel_subscription' current_subscription.id %}"
            class="btn btn-sm btn-outline-danger ms-2">Cancel</a>
        {% endif %}
    </div>
    {% endif %}

    <div class="row">
        {% for plan in plans %}
        <div class="col-md-4 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">{{ plan.name }}</h5>
                </div>
                <div class="card-body">
                    <p class="card-text text-muted">{{ plan.description }}</p>
                    
                    <div class="mb-3">
                        <h6 class="fw-bold">Pricing:</h6>
                        <strong>Monthly:</strong> ${{ plan.price_monthly }}<br>
                        <strong>Yearly:</strong> ${{ plan.price_yearly }}
                    </div>
                    
                    <div class="mb-3">
                        <h6 class="fw-bold">Limits:</h6>
                        Users: {{ plan.max_users }}<br>
                        Storage: {{ plan.max_storage_mb }} MB<br>
                        Projects: {{ plan.max_projects }}
                    </div>
                    
                    <!-- Display Features -->
                    {% if plan.plan_features.all %}
                    <div class="mb-3">
                        <h6 class="fw-bold"><i class="fas fa-star text-warning"></i> Features Included:</h6>
                        <div class="features-list">
                            {% for plan_feature in plan.plan_features.all %}
                            <div class="feature-item mb-2">
                                <span class="badge bg-success me-1">
                                    <i class="fas fa-check"></i> {{ plan_feature.feature.name }}
                                </span>
                                {% if plan_feature.feature_limit %}
                                <small class="text-muted">(Limit: {{ plan_feature.feature_limit }})</small>
                                {% else %}
                                <small class="text-success">(Unlimited)</small>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% else %}
                    <div class="mb-3">
                        <small class="text-muted"><i class="fas fa-info-circle"></i> No features configured yet</small>
                    </div>
                    {% endif %}
                </div>
                
                <div class="card-footer bg-light">
                    {% if is_super_admin %}
                    <div class="d-grid gap-2">
                        <a href="{% url 'plans:plan_features_manage' plan.id %}" class="btn btn-info">
                            <i class="fas fa-cog"></i> Add Features
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12">
            <div class="alert alert-info">No plans available.</div>
        </div>
        {% endfor %}
    </div>
</div>

<style>
    .feature-item {
        padding: 5px 0;
        border-bottom: 1px dotted #e0e0e0;
    }
    .feature-item:last-child {
        border-bottom: none;
    }
    .features-list {
        max-height: 200px;
        overflow-y: auto;
    }
    .card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15) !important;
    }
</style>
{% endblock %}