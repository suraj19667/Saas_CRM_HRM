{% extends 'base.html' %}
{% block content %}
<div class="content-header">
    <h1>Invoices</h1>
</div>
<div class="card">
    <div class="card-body">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Tenant</th>
                    <th>Subscription</th>
                    <th>Invoice #</th>
                    <th>Amount</th>
                    <th>Tax</th>
                    <th>Discount</th>
                    <th>Total</th>
                    <th>Invoice Date</th>
                    <th>Due Date</th>
                    <th>Status</th>
                    <th>Created At</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% if invoices and invoices|length > 0 %}
                {% for inv in invoices %}
                <tr>
                    <td>{{ inv.id }}</td>
                    <td>{{ inv.tenant.name }} ({{ inv.tenant.id }})</td>
                    <td>{% if inv.subscription %}{{ inv.subscription.id }}{% else %}-{% endif %}</td>
                    <td>{{ inv.invoice_number }}</td>
                    <td>{{ inv.amount }}</td>
                    <td>{{ inv.tax }}</td>
                    <td>{{ inv.discount }}</td>
                    <td>{{ inv.total_amount }}</td>
                    <td>{{ inv.invoice_date|date:"Y-m-d" }}</td>
                    <td>{% if inv.due_date %}{{ inv.due_date|date:"Y-m-d" }}{% else %}-{% endif %}</td>
                    <td>{{ inv.status }}</td>
                    <td>{{ inv.created_at|date:"Y-m-d H:i" }}</td>
                    <td><a class="btn btn-sm btn-primary" href="#">View</a></td>
                </tr>
                {% endfor %}
                {% elif transactions and transactions|length > 0 %}
                {% for tx in transactions %}
                <tr>
                    <td>-</td>
                    <td>{% if tx.tenant %}{{ tx.tenant.name }} ({{ tx.tenant.id }}){% else %}-{% endif %}</td>
                    <td>{% if tx.plan %}{{ tx.plan.id }}{% else %}-{% endif %}</td>
                    <td>{{ tx.razorpay_order_id }}</td>
                    <td>{{ tx.amount }}</td>
                    <td>-</td>
                    <td>-</td>
                    <td>{{ tx.amount }}</td>
                    <td>{{ tx.created_at|date:"Y-m-d" }}</td>
                    <td>-</td>
                    <td>{{ tx.status }}</td>
                    <td>{{ tx.created_at|date:"Y-m-d H:i" }}</td>
                    <td><a class="btn btn-sm btn-primary" href="#">View</a></td>
                </tr>
                {% endfor %}
                {% else %}
                <tr>
                    <td colspan="13">No invoices found.</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}